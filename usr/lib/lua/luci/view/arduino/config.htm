<%
local http = require("luci.http")
http.prepare_content("text/html; charset=utf-8")
-%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
  <link rel="stylesheet" type="text/css" href="<%= resource %>/arduino/style.ugly.css" />
  <title>Y&uacute;n &#20113;</title>
</head>
<body>
<div id="container">
  <div id="header">
    <div class="wrapper">
      <h1>Y&uacute;n &#20113;</h1>

      <div id="logo"><img src="<%= resource %>/arduino/logo.png" alt="Y&uacute;n &#20113;"/></div>
    </div>
  </div>
  <div id="content">
    <div class="wrapper">
<form id="form1" name="form1" method="post" onsubmit="javascript:return formCheck(this) && send_post('<%=pcdata(controller .. "/arduino/config")%>', this, 'real_form', 'wifi.country', 'wifi.ssid', 'wifi.encryption', 'wifi.password', 'hostname', 'timezone_desc', 'password');" action="#">
  <div id="error_container" class="hidden">
    <p>An error has occurred.</p>
  </div>
  <ul>
    <li>
      <label class="title">
        Your Y&uacute;n &#20113;
      </label>
      <br/>
    </li>

    <li>
      <label class="desc" for="hostname">
        Y&uacute;n &#20113; name <span class="req">*</span>
      </label>

      <div class="input_container">
        <input id="hostname" name="hostname" type="text" value="<%= hostname %>" maxlength="255">
      </div>
    </li>

    <li>
      <label class="desc" for="password">
        Password
      </label>

      <div class="input_container">
        <input id="password" name="password" type="password" maxlength="255">
      </div>
    </li>

    <li>
      <label class="desc" for="wifi.country">
        Country: <span class="req">*</span>
      </label>

      <div class="input_container">
        <select id="wifi.country" name="wifi.country">
          <option value="00"
          <%if wifi["country"] == "00" then %>
          selected="selected"
          <% end %>
          >Rest of the world</option>
          <% for k, country in ipairs(countries) do %>
          <option value="<%= country["code"] %>"
          <%if wifi["country"] == country["code"] then %>
          selected="selected"
          <% end %>
          ><%= country["label"] %></option>
          <% end %>
        </select>
      </div>
    </li>

    <li>
      <label class="desc" for="timezone_desc">
        Timezone: <span class="req">*</span>
      </label>

      <div class="input_container">
        <select id="timezone_desc" name="timezone_desc">
          <option value="UTC"
          <%if timezone_desc == "UTC" then %>
          selected="selected"
          <% end %>
          >UTC</option>
          <% for k, tz in ipairs(timezones) do %>
          <option value="<%= tz["label"] %>"
          <%if timezone_desc == tz["label"] then %>
          selected="selected"
          <% end %>
          ><%= tz["label"] %></option>
          <% end %>
        </select>
      </div>
    </li>

    <li>
      <label class="title">
	WiFi parameters
      </label>
      <br/>
    </li>

    <li>
      <label class="desc" for="wifi.ssid">
	WiFi name <span class="req">*</span>
      </label>

      <div class="input_container">
	<input id="wifi.ssid" name="wifi.ssid" type="text" value="<%= wifi["ssid"] %>" maxlength="255">
      </div>
    </li>

    <li>
      <label class="desc" for="wifi.encryption">
	Security <span class="req">*</span>
      </label>

      <div class="input_container">
	<select id="wifi.encryption" name="wifi.encryption" onchange="javascript:onchange_security(this);">
          <% for k, encryption in ipairs(encryptions) do %>
	  <option value="<%= encryption["code"] %>"
	  <% if wifi["encryption"] == encryption["code"] then %>
	  selected="selected"
	  <% end %>
	  ><%= encryption["label"] %></option>
	  <% end %>
	</select>
      </div>
    </li>

    <li>
      <label class="desc" for="wifi.password">
	Password <span id="req_3" class="req"
        <% if wifi["encryption"] == "none" then %>
        style="visibility:hidden;"
        <% end %>>*</span>
      </label>

      <div class="input_container">
	<input id="wifi.password" name="wifi.password" type="password" value="" maxlength="255">
      </div>
    </li>

    <li>
      <div class="input_container">
	<input class="btTxt submit saveForm" type="submit" value="Configure &amp; Restart">
      </div>
    </li>

  </ul>
</form>
      <form id="real_form" name="real_form" method="post" action="<%=pcdata(controller .. "/arduino/config")%>">
        <input type="hidden" name="pgp_message" value=""/>
      </form>
    </div>
  </div>
  <!-- #content -->
  <br class="clear"/>
</div>
<!-- #container -->
<script type="text/javascript" charset="utf-8" src="<%= resource %>/arduino/gpg.ugly.js"></script>
<script language="javascript">
  var pub_key = "<%= pub_key %>";
</script>
<script type="text/javascript" charset="utf-8" src="<%= resource %>/arduino/webpanel.ugly.js"></script>
</body>
</html>
